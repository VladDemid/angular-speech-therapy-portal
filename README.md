# Logogo (внутренняя документация)

Чем занимается портал:
онлайн консультации комплексная диагностика индивидуальные занятия со специалистами:
логопеды, психологи, сурдопедагоги, тифлопедагоги, специалисты по РАС, специалисты по двигательной реабилитации детей с ДЦП. Тут название "специалист" более правильно, чем "доктор". Но в проекте может встречаться "доктор", т.к. я не знал этого раньше) 

Технологии: 
- Angular 13.1.1
- Firebase 8.10.0 (namespaced, not modular)

Дополнительные сервисы:
- Telegram bot
- Sendgrid - email sending service
- Alfa bank acquiring (in dev..)

## Архитектура приложения

3 модуля angular:
- "app" - основной (все первичное, чтобы ознакомиться с порталом)
   > 
   - Главная страница 
   - Регистрация
   - пользовательское соглашение. 
   >
   routing -> app-routing.module 
   
- "profile" - для для страниц /profile/.. - личный кабинет пользователя
   >
   - поиск специалистов
   - календарь
   - редактирование своих данных
   >
   routing в модуле

- "admin" - админская панель
   >
   - ручная регистрация одобренных спецов 
   - ручное изменение пользователей в БД firebase
   - другие функции по необходимости (in dev..)
   >
   routing в модуле

## Services

Сервисы из папки `shared/services`

### firebase.service
   
   - хранение currentUser, userToken после логина
   - Доступ к функционалу firebase посредством REST и SDK
   - firebase SDK инициализируется используя environment.firebaseConfig 
 - База данных + storage (.jpg)
   - REST запросы кроме "GET" должны дополняться токеном. Пример: `link....json?auth=${authToken}`. Присутствуют функции с запросами без токенов. Это старые функции, возможно нигде уже не используемые
   - SDK запросы выполняются посредством внутренних методов `firebase.storage()` , `firebase.database()`
- Firebase functions
   - Приватные функции: `.httpsCallable('funcName')` запуск через внутренний SDK. Соответственно функция .`onCall()` 
   - Публичные функции `.onRequest()`. Доступные по `"GET"` запросу по своим прямомым постоянным адресам.
- Hosting
   - тест продакшн билда 

#### Структура БД

Базовые понятия
- userid генерируется firebase'ом 28+ символов
- orderId "2021_5_18_13_uhynpo" - year_month_day_time_shortId 
- shortId генерируем мы при регистрации нового спеца 6 символов

>!Важно: альфа не принимает id заказа магазина больше 36 символов. Скорее всего если каждый клик (даже на одно и то же время одного спеца) это отдельный заказ, то надо генерить вообще рандомный id. Но как хранить миллиарды этих id и проверять, что такой заказ уже сделан/зарезервирован другим клиентом я не знаю.

##### users
 - Name
 - userType(client/doctor)
 - email
 - и т.д

В случае спеца еще
- инфа о специализации
- weeklySchedule расписание по дням недели когда можно записаться
- короткий id 6 символов (возможно понадобится для генерации id заказа покороче)
- events - занятия этого спеца

##### events 
   > Список всех занятий. Это скорее всего надо удалять. Было создано, когда я не умел в правила доступа записи/чтения разных областей БД. И дабы не давать пользователям редактировать напрямую данные спеца, записывал сначала в клиента и в events, откуда доктор уже проверял есть ли новое занятие или нет. Что полная фигня, надо переделывать. Но уже как придумаем норм структуру БД со всеми правилами доступа клиентов/спецов/админки

##### shortIds
   При регистрации нового доктора, тут чекается новый shortId на уникальность и дописывается сюда. 

##### orders
   Планируемый раздел с заказами (уже по уму сделанный)
   - orderIdAlfa
   - orderIdLogogo
   - date, time
   - clientId, clientName
   - doctorId, doctorName (или specId/specName)
   


### auth.service
   - доступ к localStorage userId item для некоторых проверок наличия сессии
   
### cookie.service
   - пока только для попапа "подтвердите cookie"

### crypter.service 
   - шифровка - расшифровка строк
   - при открытии стриницы спеца `/doctor/id` его id там пишется в зашифрованном виде (не знаю зачем, пускай будет пока)

### popup.service
   - хранение состояний попапов (показать/скрыть) и методы toggle для них

### telegram-bot.service
   - отправка сообщений во внутренний чат для разработки и предположительно мониторинга записей на занятия в первое время.

### develop-help 
   - не используется

### zoom.service
- уже не используется, не суть




